---
output:
  bookdown::pdf_document2:
    fig_caption: true
    number_sections: true
    latex_engine: xelatex
    toc: true
    includes:
        before_body: title.tex
mainfont: "Times New Roman"
fontsize: 11pt
knit: (function(inputFile, encoding) {
        rmarkdown::render(inputFile,
                          encoding = encoding, 
                          output_dir = "document_output")
      })
header-includes:
  - \pagenumbering{gobble}
  - \usepackage{amsmath,fancyhdr, caption}
  - \captionsetup{width=1.3\linewidth, labelfont={bf}}
bibliography: reference.bib
csl: https://www.zotero.org/styles/pnas
nocite: |
  @duranteNoteMultiplicativeGamma2017, @myersMaximumReproductiveRate1999, @gotoEcologicalMorphologicalDivergence1975,@gotoLifeHistoryDistibution1981, @ministryofenvironmentofjapanThreatenedWildlifeJapan2014, @natsumedaEvaluationEcologicalFeatures2010, @fishbaseFishBaseHttpsWww
---

```{r setup, include=FALSE}

suppressMessages(source(here::here("code/set_rmd.R")))
```

```{=tex}
\newpage
\pagestyle{fancy}
\fancyhead[L]{Terui et al.}
\fancyhead[C]{}
\setlength{\headheight}{13.7pt}
\pagenumbering{arabic}
\def\figurename{Figure S\hspace{-.4ex}}
\def\tablename{Table S\hspace{-.4ex}}
```
# Methods

## Theory

### Model

We employed a multi-species Ricker model [@fowlerSpeciesDynamicsAlter2012]. In the basic formula without intentional release, the population density of species $i$ at time $t+1$, $N_{i,t+1}$, is modeled as:

```{=tex}
\begin{align}
N_{i,t+1} = N_{i,t}~\exp\left[r_i \left(1-\frac{\sum_{j=1}^S \alpha_{ij}N_{j,t}}{K_i} \right) \right]\exp(\varepsilon_{i,t})
\end{align}
```
where $r_i$ is the intrinsic growth rate, $\alpha_{ij}$ the competition coefficient of species $j$ on $i$, $K_i$ the carrying capacity, and $\varepsilon_{i,t}$ the species response to stochastic environmental fluctuations that obey a normal distribution $\text{Normal}(0, \sigma_{\varepsilon}^2)$. We modified this formula to include the effects of intentional release (species 1) on reproduction and competition as follows:

```{=tex}
\begin{align}
N_{i,t+1} = (N_{i,t}+\phi_i R_t)~\exp \left[r_i \left\{1-\frac{\alpha_{i1} (N_{1,t} + R_t) + \sum_{j=2}^S \alpha_{ij}N_{j,t}}{K_i} \right\} \right]\exp(\varepsilon_{i,t})
(\#eq:ricker)
\end{align}
```
$R_t$ is the number of released individuals, and the parameter $\phi_i$ controls the relative fitness of captive-bred individuals:

```{=tex}
\begin{align}
\phi_i = 
\left\{
\begin{array}{cc}
f_R & (i = 1)\\
0 & (i \ne 1)
\end{array}
\right.
\end{align}
```
$f_R~(\ge 0)$ is the density-independent survival of captive-bred individuals relative to wild individuals. Equation \@ref(eq:ricker) can be reorganized to:

```{=tex}
\begin{align}
N_{i,t+1} = (N_{i,t}+\phi_i R_t) ~ \exp \left[r_i \left(1-\frac{\alpha_{i1}R_t + \sum_{j=1}^S \alpha_{ij}N_{j,t}}{K_i} \right) \right]\exp(\varepsilon_{i,t})
\end{align}
```
In this model, intrinsic growth rates of unenhanced species $r_{i,i \ne 1}$ and interspecific competition $\alpha_{ij}$ are random draws from a uniform ($r_{i,i \ne 1} \sim \text{Unif}(0.5,r_{max})$) and an exponential distribution ($\alpha_{ij} \sim \text{Exp}(1/\bar{\alpha})$), respectively. We assumed constant values of intraspecific competition ($\alpha_{ii}=1$), carrying capacity $(K_i = K)$ and the number of releases $(R_t=R)$.

### Model analysis

First, we analyzed a two-species community to gain insights into the model behavior and to guide the N-species analysis. Specifically, we examined the release effect with $20$ parameter values of intrinsic population growth rate $r_i$ ($0.5$ to $3.5$ with an equal interval) and carrying capacity $K$ ($50$ to $500$ with an equal interval), resulting in $400$ parameter combinations. In a single-species Ricker model, the chosen range of $r_i$ can generate stable equilibrium, damped oscillations, limit cycle, and chaos [@sunDynamicBehaviorsRicker2000]. For simplicity, we assumed $r_1 = r_2$. We crossed this parameter setup with environmental stochasticity ($\sigma_{\varepsilon} =$ `r unique(list_param[[1]]$sd_env)`) and competition strength ($\alpha_{ij} =$ `r unique(list_param[[1]]$alpha)`) and generated `r nrow(list_param[[1]])` simulation scenarios ($400 \times 2 \times 2$).

Under each simulation scenario, we ran `r attr(list_param[[1]], "n_sim")` timesteps of community dynamics for $100$ values of release level $R$ ($0$ to $500$ with an equal interval). We introduced $50$ individuals of each species and allowed them to grow with no intentional release for the first `r unique(list_sim[[1]]$n_warmup)` timesteps (initialization). After the initialization period, we released $R$ individuals of the enhanced species every timestep over the next `r unique(list_sim[[1]]$n_burnin)` timesteps to reach a new equilibrium with the intentional release (burn-in period). We continued the simulation run with intentional release and saved the last `r unique(list_sim[[1]]$n_timestep)` timesteps, which were used to obtain the following summary statistics of the whole community $\sum_i^S N_i$ ($S$: the number of species): the coefficient of variation (CV), the temporal mean ($\mu$), and the SD ($\sigma$). The results of the two-species system were reported in [Supplementary Text].

We subsequently analyzed a whole community model with 10 species using important parameter combinations identified in the two-species simulation: intrinsic growth of enhanced species ($r_1 =$ `r unique(list_param[[2]]$r1)`), average strength of interspecific competition ($\bar{\alpha}=$ `r unique(list_param[[2]]$alpha)`), carrying capacity ($K=$ `r unique(list_param[[2]]$k)`). We also varied relative fitness of captive-bred individuals ($f_R=$ `r unique(list_param[[2]]$phi)`) as this is a common interest in captive-breeding programs. Meanwhile, we fixed values of the following parameters: the number of species ($S=$ `r unique(list_param[[2]]$n_species)`), maximum intrinsic growth rate of unenhanced species ($r_{max}=$ `r unique(list_param[[2]]$r_max)`), and environmental stochasticity ($\sigma_{\varepsilon}=$ `r unique(list_param[[2]]$sd_env)`). This simulation setup resulted in `r nrow(list_param[[2]])` sets of parameter combinations.

As with the two-species model, we ran `r attr(list_param[[2]], "n_sim")` timesteps of community dynamics with `r max(list_sim[[2]]$n_rep)` values of release level $R$ ($0$ to $500$ with a constant interval) for each simulation scenario. In this simulation, we initialized the community by introducing five individuals of each species and repeated this seeding every ten timesteps to account for possible complex dynamics of a ten-species community. In addition, we defined a threshold density ($N_i = 0.01$) below which species are removed from the simulation (i.e., an absorbing condition) and are recorded as "extinct". The rest of the simulation procedure is identical to the two-species model. We summarized values of simulation parameters in **Table S**\@ref(tab:tab-para).

## Empirical analysis

### Data

**Time-series data.** We assembled time-series fish data at `r n_distinct(d0$site_id)` sites within `r n_distinct(d0$river)` protected watersheds of Hokkaido Island, Japan. The Hokkaido Research Organization leads a long-term monitoring program at these watersheds, and the data are published as annual reports [@salmonandfreshwaterfisheriesresearchinstitutehokkaidoresearchorganizationAnnualReportMonitoring2021]. The program began in 1963, but an effective, standardized sampling method has been implemented since 1999 (two-pass sampling with a combination of electrofishing and cast net). Most data were collected in summer with irregular interannual intervals (1- to 3-year intervals for most cases), and sampling efforts were quantified by sampling area (average: `r op(mean(df_area$area))` $\pm$ `r op(sd(df_area$area))` m^2^). We confined our analysis to the sites that meet the following criteria: (i) the observation span (from the first to the last year of observation) exceeds ten years, (ii) the number of observation years exceeds five years, and (iii) masu salmon is observed at least twice during the observation period. As a result, we used time-series data at `r n_distinct(df_fish$site_id)` sites within `r n_distinct(df_fish$river)` watersheds from 1999 to 2019. The summed abundance of first and second passes was used in the following analysis. **Table S**\@ref(tab:tab-splist) summarizes observed species in these watersheds.

**Fish release.** The release of masu salmon began in the 1950s. Hatchery fish are released in spring (fry and smolt stages) and fall (juvenile stage). Although the fish release occurs at multiple locations within a watershed, the release information is available only at the watershed level. For each release stage, we assembled annual records of intentional release (the number of fish released; 1999-2019) from annual investigations by the Japan Fisheries Research and Education Agency and Salmon and Freshwater Fisheries Research Institute. During the study period, the majority of release took place in spring at a fry stage (fry : juvenile : smolt = `r pull(df_stock_stage, ratio)[1]` : `r op(pull(df_stock_stage, ratio)[2])` : `r op(pull(df_stock_stage, ratio)[3])`)

**Environmental data.** At each sampling site, we measured the following environmental variables as potential covariates: upstream watershed area (km^2^; a proxy for stream size), proportional land use in the upstream watershed (forest, urban, agriculture), local climates (annual mean air temperature [$^\circ C$] and cumulative precipitation [mm]), and ocean productivity (sea surface chlorophyll *a* concentration [mg m^-3^]). We used MERIT Hydro [@yamazakiMERITHydroHighresolution2019] to delineate the upstream watershed polygon for each sampling site. We estimated the proportion of forest, urban, and agriculture in each watershed polygon based on land use data in 2015 from Copernicus Global Land Service (100-m resolution) [@marcelbuchhornCopernicusGlobalLand2020]. Climate data at each sampling site were extracted from CHELSA version 1.2 [@kargerClimatologiesHighResolution2017; @kargerDataClimatologiesHigh2018]. We extracted annual data of chlorophyll *a* concentration (2002 -- 2019; resolution, 4.6 km^2^) from OceanColor [@seawifsmissionpageNasaOceanBiology2019] as a proxy for ocean productivity and calculated the average value within the 30-km radius of each river mouth. We used the following R packages to perform geospatial analysis: *sf* [@pebesmaSimpleFeaturesStandardized2018]*, raster* [@hijmansRasterGeographicData2020]*, exactextractr* [@bastonExactextractrFastExtraction2020]*, stars* [@pebesmaStarsSpatiotemporalArrays2020]*, whitebox* [@lindsayWhiteboxGATCase2016]*.*

### Statistical analysis

**Community dynamics comparison.** Our goal is to compare temporal community dynamics across sites. However, the data are not comparable because of observation errors (e.g., different observers) and missing observations. To confront this challenge, we developed a Bayesian state-space model for two species groups separately: (i) enhanced species, the abundance of masu salmon, and (ii) unenhanced species, the summed abundance of all species except masu salmon. A Bayesian state-space model is best suited for our analysis because it can account for observation errors while imputing missing values given the long-term trend at each site [@clarkPopulationTimeSeries2004; @keryBayesianPopulationAnalysis2012]. The model is composed of observation and state models, as described below.

In the observation model, we model observation processes. Fish abundance at site $s$ in year $t$ (either enhanced or unenhanced species), $N_{s,t}$, was assumed to follow a Poisson distribution:

```{=tex}
\begin{align}
N_{s,t} \sim \text{Poisson}(\lambda_{s,t} A_{s,t})
\end{align}
```
where $\lambda_{s,t}$ is the expected fish density (individual m^-2^) and $A_{s,t}$ the sampling area (m^2^). Since fish sampling was conducted after the spring release of masu salmon, captured fish may include individuals released in the observation year. We explicitly modeled this observation process to avoid biases in estimating temporal community trends:

```{=tex}
\begin{align}
\lambda_{s,t} = n_{s,t}\exp(\varepsilon_{s,t}^{\text{obs}}) + \psi \beta_s~Fry_{w(s),t}
\end{align}
```
$n_{s,t}$ is the "true" fish density excluding fish released in the spring, $Fry_{w(s),t}$ the number of salmon fry released (unit: million fish) in spring in watershed $w$ within which site $s$ is located, and $\beta_s$ the site-specific effect of released salmon fry on the observed fish density. The parameter $\beta_s$ was drawn from a normal distribution with the hyper-mean $\theta_{\beta}$ and hyper-variance $\sigma_{\beta}^2$. The parameter $\varepsilon_{s,t}^{\text{obs}}$ is the error term that follows a normal distribution $\text{Normal}(0, \sigma_{\text{obs},s}^2)$. The inclusion of this term allows the model to account for site- and year-specific observation errors, which can be caused by ecological and/or artificial factors. When modeling the unenhanced species group, $\psi$ equals zero (otherwise $\psi = 1$) so the model excludes the term $\beta_s~Fry_{w(s),t}$.

In the state model, we model temporal dynamics of fish density $n_{s,t}$ as follows:

```{=tex}
\begin{align}
\begin{split}
&\ln n_{s,t} = \xi_{1,s} + \xi_{2,s} \ln n'_{s,t-1} + \varepsilon_{s,t}^{\text{state}}\\
&\ln n'_{s,t-1} = \frac{\sum_{q=1}^Q (\tau^{q} \ln n_{s,t-q})}{\sum_{q=1}^Q \tau^{q}}
\end{split}
(\#eq:state)
\end{align}
```
where $\xi_{1,s}$ is the site-specific constant at site $s$, $\xi_{2,s}$ the parameter characterizing an autoregressive (AR) process, and $\varepsilon_{s,t}^{\text{state}}$ the process error that follows a normal distribution as $\varepsilon_{s,t}^{\text{state}} \sim \text{Normal}(0, \sigma_{\text{state},s}^2)$. The parameters $\xi_{1,s}$ and $\xi_{2,s}$ were drawn from a multivariate normal distribution as $\pmb{\xi} \sim \text{MVN}(\pmb{\theta_{\xi}}, \pmb{\Omega_{\xi}})$, where $\pmb{\xi}$ is the matrix of $\xi_{1,s}$ and $\xi_{2,s}$. Equation \@ref(eq:state) is structurally equivalent to a $Q$-order AR model; however, we expressed the part of AR parameters as a geometric-series $\tau^q$ to reduce the number of parameters (our model has two AR parameters $\xi_{2,s}$ and $\tau$ regardless of order $Q$). The parameter $\tau$ controls how fast the density influence attenuates towards the past [@takagiTimescaleDependencyHost2015]. In this study, we set $Q=3$ given the life span of the study species (typically 1 -- 3 years). We used median estimates of fish density $n_{s,t}$ to calculate the temporal CV, mean ($\mu$), and SD ($\sigma$) for each site. For a whole community, we summed the densities of enhanced and unenhanced species. We summarized the reconstructed community dynamics in **Figures S**\@ref(fig:fig-d1) -- **S**\@ref(fig:fig-d3).

We assessed the predictive performance of our model using the Bayesian p-value [@keryIntroductionWinBUGSEcologists2010], a value of which takes a range of 0 --1 and indicates over- (\~0.00), under- (\~1.00), or suitable-fitting (\~0.50) to the data. A Bayesian p-value for our state-space models was `r op(round(df_bp$mean, 2))`, indicating that our model specification is appropriate.

We used linear regression to quantify the impact of the intentional release on community dynamics. Although our focus is intentional release, each model included climatic and local abiotic variables to account for important environmental differences among sites. Specifically, we developed the following linear regression model taking either species richness (the number of species present during the observation period), mean, or SD as a response variable $y_s$.

```{=tex}
\begin{align}
\left\{
\begin{aligned}
y_s &\sim \text{Poisson}(\lambda_{y,s} \exp(\varepsilon_{\lambda,s})) &&\text{for species richness}\\
\ln \pmb{y_s} &\sim \text{MVN}(\pmb{\theta_{y,s}}, \pmb{\Omega_y}) &&\text{for mean and SD}
\end{aligned}
\right.
 (\#eq:reg)
\end{align}
```
In the poisson model for species richness, $\exp(\varepsilon_{\lambda,s})$ is the error term accounting for overdispersion ($\varepsilon_{\lambda,s} \sim \text{Normal}(0, \sigma_{\lambda}^2)$). In the multivariate normal model, $\pmb{y_s}$ represents a vector of mean and SD at site $s$, which is modeled as a random variable drawn from a multivariate normal distribution with the variance-covariance matrix $\pmb{\Omega_y}$. The expected means $\lambda_{y,s}$ and $\pmb{\theta_s}$ were related to linear predictors as follows:

```{=tex}
\begin{align}
\left\{
\begin{aligned}
\ln \lambda_{y,s} &= \gamma_{0,w(s)} + \gamma_1 R'_{s} + \sum_k \gamma_kx_{k,s} &&\text{for species richness}\\
\theta_{y,s} &= \gamma_{0,w(s)} + \gamma_1 R'_{s} + \sum_k \gamma_k x_{k,s} &&\text{for mean and SD}
\end{aligned}
\right.
(\#eq:model)
\end{align}
```
$\gamma_{0,w(s)}$ is the watershed-specific intercept ($w(s)$ refers to site $s$ nested within watershed $w$) and $\gamma_k (k = 1,2,...)$ is the $k^\text{th}$ regression coefficient [effective release of masu salmon $R'_s$ ($k = 1$) and other site-level predictors $x_k$ ($k \ge 2$)]. $R'_s$ is the product of the average yearly release at watershed $w$ ($R_w$; fry + juvenile + smolt, averaged for 1999 -- 2019) and the site-specific weight factor $\eta_{w,s'}$ ($s'=1,...,S_w + 1$, where $S_w$ is the number of sites within watershed $w$):

```{=tex}
\begin{align}
\begin{split}
R'_s &= \eta_{w,s'} R_w\\
\sum_{s'}^{S_w + 1} \eta_{w,s'} &= 1
(\#eq:effr)
\end{split}
\end{align}
```
In Equation \@ref(eq:effr), $\eta_{w,s'}$ represents the effective proportion of total release affecting the community at site $s'$ within watershed $w$. The summation of $\eta_{w,s'}$ over $S_w+1$ is assumed to be unity because a non-negligible portion of release may escape into unsurveyed areas. Since the values of $\eta_{w,s'}$ are not available in our dataset, we estimated them through a stochastic search while fitting the regression model to the data within a Bayesian framework (see **model fitting**). Other site-level predictors include upstream watershed area (log-transformed), air temperature, precipitation, and forest land use. Urban and agricultural land use was omitted because of either a limited value range (**Figure S**\@ref(fig:fig-env)) or a strong correlation with forest land use (**Figure S**\@ref(fig:fig-cor)). The watershed-specific intercept was related to a watershed-level predictor as:

```{=tex}
\begin{align}
\begin{split}
\gamma_{0,w} &\sim \text{Normal}(\theta_{\gamma,w},\sigma_{\gamma}^2)\\
\theta_{\gamma,w} &= \gamma'_0 + \gamma'_1 x'_{w}
\end{split}
\end{align}
```
$\gamma'_{0}$ is the global intercept and $\gamma'_1$ is the regression coefficient of ocean productivity $\gamma'_{w}$ (chlorophyll *a* concentration; averaged for 2002 -- 2019). Ocean productivity was included because the majority of the observed species use marine habitats at a certain life stage (i.e., diadromous). The parameter $\sigma_{\gamma}$ accounts for random variation among watersheds that the watershed-level predictor cannot capture.

Since the CV is an additive function of mean $\mu$ and SD $\sigma$ in a log scale, we can derive the effects of environmental factors on the CV from Equation \@ref(eq:model):

```{=tex}
\begin{align}
\text{E}(\ln CV_s) = \text{E}(\ln y_s^{(\sigma)}) - \text{E}(\ln y_s^{(\mu)})
\end{align}
```
Considering that $\text{E}(\ln y_s^{(\sigma)}) = \theta_{y,s}^{(\sigma)}$ and $\text{E}(\ln y_s^{(\mu)}) = \theta_{y,s}^{(\mu)}$,

```{=tex}
\begin{align}
\text{E}(\ln CV_s) = (\gamma_{0,w(s)}^{(\sigma)} - \gamma_{0,w(s)}^{(\mu)}) + (\gamma_{1}^{(\sigma)} - \gamma_{1}^{(\mu)})R'_s + \sum_k (\gamma_{k}^{(\sigma)} - \gamma_{k}^{(\mu)})x_{k,s}
\end{align}
```
All predictors were standardized (mean = 0, SD = 1) before the analysis.

**Species interaction.** We analyzed a subset of our data to estimate the strength of interspecific interactions among stream fishes. In this analysis, we focused on `r n_distinct(df_complete$site_id)` sites with $>16$ years of observations and no intentional release of masu salmon. Further, at each site, we confined our analysis to species that occurred more than four times. These additional constraints were necessary to estimate parameters in a complex multi-species model within a state-space modeling framework.

We fitted the following state-space model to the data for each site separately. In the observation model, we modeled fish abundance $N_{i,t}$ for species $i$ at year $t$ as:

```{=tex}
\begin{align}
\begin{split}
N_{i,t} \sim \text{Poisson}(\lambda_{i,t} A_{t})\\
\lambda_{s,t} = n_{i,t}\exp(\varepsilon_{i,t}^{\text{obs}})
\end{split}
\end{align}
```
where $\varepsilon_{i,t}^{\text{obs}} \sim \text{Normal}(0, \sigma_{\text{obs},i})$. In the state model, we described a multi-species Ricker model for fish density $n_{i,t}$:

```{=tex}
\begin{align}
\ln n_{i,t} = \ln n_{i,t-1} + r_{i} - \sum_{j=1}^S\alpha'_{ij} n_{i,t-1} + \varepsilon_{i,t}^{\text{state}}
(\#eq:ricker-ssm)
\end{align}
```
Equation \@ref(eq:ricker-ssm) is equivalent to Equation \@ref(eq:ricker) except the scale of competition coefficients $\alpha'_{ij}$ ($\frac{\alpha'_{ij}}{\alpha'_{ii}}=\alpha_{ij}$, where $\alpha'_{ii}=\frac{r_i}{K_i}$). We used sparse priors for $\alpha'_{ij}$ to reduce the risk of over-fitting [@mutshindaWhatDrivesCommunity2009]:

```{=tex}
\begin{align}
\begin{split}
\alpha'_{ij} \sim \text{Half-normal}(0, \sigma^2_{\alpha, ij})\\
\sigma_{\alpha,ij}^2 = z_{ij}c_1 + (1-z_{ij})c_0
\end{split}
(\#eq:sparse)
\end{align}
```
In Equation \@ref(eq:sparse), the latent variable $z_{ij}$ is drawn from a Bernoulli distribution and controls the prior for $\alpha'_{ij}$. We used $c_1 = 1$ and $c_0 = 0.01$ so that $\alpha'_{ij}$ is freely estimated when $z_{ij}$ equals one ($\sigma^2_{\alpha} = 1$). Otherwise, the probability density of $\alpha'_{ij}$ would be concentrated around zero ($\sigma^2_{\alpha} = 0.01$), effectively omitting the parameter from the model [@mutshindaWhatDrivesCommunity2009]. We assigned different "inclusion" probabilities to diagonal (intraspecific competition) and off-diagonal elements (interspecific competition) as $z_{ii} \sim \text{Bernoulli}(p_{\alpha}^{\text{intra}})$ and $z_{ij,i \ne j} \sim \text{Bernoulli}(p_{\alpha}^{\text{inter}})$.

We assumed that environmental noise $\varepsilon_{i,t}^{\text{state}}$ is correlated among species by introducing the variance-covariance matrix $\pmb{\Omega_{\varepsilon}}$. The matrix $\pmb{\Omega_{\varepsilon}}$ was modeled with the aid of latent factors $\zeta_{t,d}$ and factor loadings $\delta_{d,i}$:

```{=tex}
\begin{align}
\varepsilon_{i,t}^{\text{state}}=\sum_{d}^{D}\zeta_{t,d}\delta_{d,i} + I_{ij}\epsilon_{i,t}
\end{align}
```
where $D$ is the number of latent factors, $\epsilon_{i,t} \sim \text{Normal}(0, \sigma_{\epsilon,i}^2)$, and $I_{ij}$ is the identity matrix ($I_{ii}=1$ and $I_{ij, i \ne j} = 0$). With this formulation, the matrix $\pmb{\Omega_{\varepsilon}}$ can be described as $\pmb{\Omega_{\varepsilon}}=\pmb{\Delta}^T\pmb{\Delta} + \text{diag}(\sigma_{\epsilon,i}^2)$, where $\pmb{\Delta}$ is the matrix of factor loadings $\delta_{d,i}$. This model structure with multiplicative gamma priors on factor loadings [@duranteNoteMultiplicativeGamma2017] has the merit of the reduced number of parameters while capturing the correlated nature of species responses to environmental fluctuations [@ovaskainenHowAreSpecies2017]. We set $D=2$ in our model. We reported the estimates of $\alpha_{ij}$, so the values are comparable to those used in the theoretical analysis.

**Model fitting.** We fitted the models to the data using JAGS version 4.1.0 through *runjags* package version 2.2.0-2 in R [@denwoodRunjagsPackageProviding2016]. We assigned vague or weakly informative priors to parameters (**Table S**\@ref(tab:tab-prior)). Four Markov chain Monte Carlo (MCMC) chains were run until parameter estimates converged. The total MCMC iterations ranged from `r min(df_mcmc$n_total_mcmc)` to `r max(df_mcmc$n_total_mcmc)`, in which MCMC samples were saved every `r unique(df_mcmc$n_thin)` steps for the calculation of posterior distributions after the initial `r max(df_mcmc$n_burn)` burn-in period. Convergence was assessed by examining whether the $\hat{R}$ indicator of each parameter approached $<1.1$ [@gelmanDataAnalysisUsing2007]. Data manipulation and analysis were performed in R version 4.2.1 [@rcoreteamLanguageEnvironmentStatistical2021]. Parameter estimates were summarized in **Tables S**\@ref(tab:tab-ssm-ar) -- **S**\@ref(tab:tab-reg3).

\newpage

# Supplementary Text

## Two-species model

The analysis of a two-species community revealed the distinct parameter space predicting a stabilizing, neutral, or destabilizing effect of intentional release. The left column in **Figure S**\@ref(fig:fig-2sp-w)**A**) shows the predictions in scenarios with no environmental stochasticity ($\sigma_{\varepsilon} =$ `r min(list_param[[1]]$sd_env)`) and weak competition ($\bar{\alpha}=$ `r min(list_param[[1]]$alpha)`). For lower values of intrinsic growth rate $r_i$ ($<1.5$), intentional release had neutral (with higher $K$) to destabilizing effects (with lower $K$) on community dynamics. In the meantime, stabilization with intentional release occurred for higher values of $r_i$ ($\ge 1.5$) by dampening limit cycles or chaos (**Figure S**\@ref(fig:fig-2sp-s)), which is reflected in decreased SD $\sigma$ (**Figure S**\@ref(fig:fig-2sp-w)). However, the long-term mean of community density $\mu$ consistently decreased with intentional release in almost all cases except for only a few combinations of $r_i$ and $K$ (**Figure S**\@ref(fig:fig-2sp-w)).

Environmental stochasticity did not change the qualitative patterns of deterministic simulations; however, it greatly expanded the parameter space with destabilizing effects of intentional release (the right columns in **Figure S**\@ref(fig:fig-2sp-w)**A and B**). In particular, destabilizing effects were more broadly observed when intrinsic growth rates were low.

Increasing the competition coefficient $\bar{\alpha}$ shifted the region with the destabilizing effects to higher carrying capacities ($\bar{\alpha}=$ `r max(list_param[[1]]$alpha)`, **Figure S**\@ref(fig:fig-2sp-s)); otherwise, general patterns were similar to the weak competition scenario.

\newpage

# Supplementary Tables

\newpage

## Simulation parameter

```{r tab-para}

suppressMessages(source(here::here("code/table_param_set.R")))
knitr::kable(df_param,
             format = "markdown",
             caption = "Parameter values used in the whole community simulation.")

```

\newpage

## Observed species

```{r tab-splist}

suppressMessages(source(here::here("code/table_species_list.R")))

knitr::kable(df_sp_list,
             format = "markdown",
             caption = "Fish species found in the study watersheds. Trait information is based on the literature [@gotoEcologicalMorphologicalDivergence1975;@gotoLifeHistoryDistibution1981;@ministryofenvironmentofjapanThreatenedWildlifeJapan2014;@natsumedaEvaluationEcologicalFeatures2010;@fishbaseFishBaseHttpsWww] and expert knowledge. Body size is coded as follows: maximum total length (TL) $< 100$ mm (S), $100\\le$  TL $\\le 200$ (M), and TL $> 200$ (L).")
```

\newpage

## Priors

```{r tab-prior}

suppressMessages(source(here::here("code/table_prior.R")))

knitr::kable(df_prior,
             format = "markdown",
             caption = "Prior distributions used in the Bayesian models. See Durante [@duranteNoteMultiplicativeGamma2017] for multiplicative gamma priors. The parameter $\\pmb{\\omicron}$ is a vector of prior scales ($\\pmb{\\omicron}=2.5,...,2.5$).")

```

\newpage

## Parameter estimates for the state-space autoregressive model

```{r tab-ssm-ar}

suppressMessages(source(here::here("code/table_ssm_ar.R")))

knitr::kable(df_ssm_ar,
             align = c(rep("l", 2), rep("r", 2)),
             format = "markdown",
             caption = "Median estimates for key parameters of the state-space autoregressive model. Site-specific parameters were excluded due to a large number of parameters.")

```

\newpage

## Parameter estimates for the state-space Ricker model

```{r tab-ricker}

suppressMessages(source(here::here("code/table_ricker.R")))

knitr::kable(df_ricker,
             align = c(rep("l", 2), rep("r", 2)),
             format = "markdown",
             caption = "Median estimates for key parameters of the state-space Ricker model. Site-specific parameters were excluded due to a large number of parameters.")

```

\newpage

```{r table_reg}

## load regression tables
suppressMessages(source(here::here("code/table_reg.R")))
j <- 7

## conditional text
c_text <- case_when(group == "all" ~ "whole community",
                    group == "masu_salmon" ~ "masu salmon",
                    group == "other" ~ "unenhanced species")

table_reg_chunk <- knit_chunk <- table_legend <- NULL

for(i in seq_len(length(list_reg))) {
  
  table_legend[i] <- paste0("Parameter estimates for the regression model (", c_text[i], "). Median estimates and standard errors (SEs) of regression coefficients are shown. Pr(> 0) and Pr(< 0) represent the proportion of positive and negative estimates in MCMC samples, respectively (i.e., posterior probability).")

  
  knit_chunk <- paste0("## Parameter estimates for the regression model (", c_text[i], ")",
                       "\n```{r tab-reg", i, "}
                       \n\n
                       kable(list_reg[[",i,"]],
                             align = c(rep('l', 2), rep('r', 4)),
                             format = 'markdown',
                             caption = table_legend[",i,"])
                       \n\n
                       ```\n",
                       "\n\\pagebreak\n")

  table_reg_chunk <- c(table_reg_chunk, knit_chunk)
  
}


```

`r paste(knitr::knit(text = table_reg_chunk), collapse = '\n')`

# Supplementary Figures

## Theoretical prediction (two-species community with weak competition)

```{r fig-2sp-w, fig.cap = paste0("Theoretical predictions in a two-species community. **(A)** Spearman's rank correlations between intentional release and community dynamics in a weak competition scenario ($\\bar{\\alpha}=$ ", min(list_param[[1]]$alpha) ,"). Rows distinguish different summary statistics of community dynamics (top: CV, middle: mean, bottom: SD) while columns distinguish deterministic ($\\sigma_{\\varepsilon}=$ ", min(list_param[[1]]$sd_env) ,") and stochastic simulations ($\\sigma_{\\varepsilon}=$ ", max(list_param[[1]]$sd_env) ,"). Cells indicate 400 combinations of carrying capacity and intrinsic growth rate (20 values each). Colors are proportional to Spearman's rank correlations. Dots indicate parameter combinations that are used in the whole community simulation. Broken vertical lines denote the average value of $r_i$ (1.43) for salmonid species [@myersMaximumReproductiveRate1999]. **(B)** Examples of community dynamics with and without intentional release. Community dynamics diverge at the broken vertical lines, the timestep at which intentional release begins. Rows distinguish intrinsic growth rates, while columns distinguish deterministic and stochastic simulations. Colors indicate release levels, and line types differ in carrying capacities.")}

source(here::here("code/si_figure_theory_2sp.R"))
knitr::include_graphics(here::here("output/figure_2sp_model_weak.pdf"))
```

\newpage

## Theoretical prediction (two-species community with strong competition)

```{r fig-2sp-s, fig.cap = paste0("Theoretical predictions in a two-species community. **(A)** Spearman's rank correlations between intentional release and community dynamics in a strong competition scenario ($\\bar{\\alpha}=$ ", max(list_param[[1]]$alpha) ,"). Rows distinguish different summary statistics of community dynamics (top: CV, middle: mean, bottom: SD) while columns distinguish deterministic ($\\sigma_{\\varepsilon}=$ ", min(list_param[[1]]$sd_env) ,") and stochastic simulations ($\\sigma_{\\varepsilon}=$ ", max(list_param[[1]]$sd_env) ,"). Cells indicate 400 combinations of carrying capacity and intrinsic growth rate (20 values each). Colors are proportional to Spearman's rank correlations. Dots indicate parameter combinations that are used in the whole community simulation.  Broken vertical lines denote the average value of $r_i$ (1.43) for salmonid species [@myersMaximumReproductiveRate1999]. **(B)** Examples of community dynamics with and without intentional release. Community dynamics diverge at the broken vertical lines, the timestep at which intentional release begins. Rows distinguish intrinsic growth rates, while columns distinguish deterministic and stochastic simulations. Colors indicate release levels, and line types differ in carrying capacities.")}

source(here::here("code/si_figure_theory_2sp.R"))
knitr::include_graphics(here::here("output/figure_2sp_model_strong.pdf"))
```

\newpage

<!--# Figure for the whole community simulation -->

```{r figure-sim}

## load figures
suppressMessages(source(here::here("code/si_figure_theory.R")))

figure_sim_chunk <- knit_chunk <- cap <- NULL

for(i in seq_len(nrow(df_param))) {
  
  cap[i] <- paste0("Theoretical predictions for the release effect in a ten-species community. Rows represent different response variables, and columns show distinct simulation scenarios with different strengths of interspecific competition ($\\bar{\\alpha}$) and relative fitness of captive-bred individuals ($f_R$). Lines are loess curves (mean) with shades indicating associated 95% confidence intervals. Other parameters are: ",
                       "number of species $S$ = ", df_param$n_species[i], "; intrinsic growth rate of an enhanced species $r_1$ = ", df_param$r1[i], "; maximum intrinsic growth rate of unenhanced species $r_{max}$ = ", df_param$r_max[i], "; environmental stochasticity $\\sigma_{\\varepsilon}$ = ", df_param$sd_env[i], "; carrying capacity $K$ = ", df_param$k[i], ".")
  
  knit_chunk <- paste0("## Theoretical prediction (",
                       "$r_1$ = `r df_param$r1[",i,"]`, ",
                       "$K$ = `r df_param$k[",i,"]`) \n",
                       "\n```{r fig-sim", i,", fig.width = 10, fig.height = 8.5, fig.cap = cap[", i, "]}
                       \n\n
                       list_g_theory[[",i,"]]
                       \n\n
                       ```\n",
                        "\n\\pagebreak\n")

  figure_sim_chunk <- c(figure_sim_chunk, knit_chunk)
  
}

```

`r paste(knitr::knit(text = figure_sim_chunk), collapse = '\n')`

<!--# Figure S10-12 -->

```{r fig-dyns}

## load figures
suppressMessages(source(here::here("code/si_figure_obs_dyns.R")))

c_text <- tibble(Group) %>% 
  mutate(text = case_when(Group == "all" ~ "whole community",
                          Group == "masu_salmon" ~ "masu salmon",
                          Group == "other" ~ "unenhanced species")) %>% 
  pull(text)

figure_dyns_chunk <- knit_chunk <- cap <- NULL

for(i in seq_len(length(list_g_dyns))) {
  
  cap[i] <- paste0("Temporal dynamics of stream fish communities (", c_text[i], ") in Hokkaido, Japan. Dots represent observed density, and solid lines are the predicted values of the Bayesian state-space model. Panels correspond to individual watersheds, and colors distinguish sampling sites within a watershed.")
    
  knit_chunk <- paste0(
    "## Temporal dynamics of stream fish communities (`r c_text[",i,"]`)\n",
    "\n```{r fig-d", i,", fig.width = 10, fig.height = 7, fig.cap=cap[", i ,"]}
    \n\n
    list_g_dyns[[",i,"]]
    \n\n
    ```\n",
    "\n\\pagebreak\n")

  figure_dyns_chunk <- c(figure_dyns_chunk, knit_chunk)
  
}

```

`r paste(knitr::knit(text = figure_dyns_chunk), collapse = '\n')`

\newpage

## Environmental variables

```{r fig-env, fig.width=11, fig.height=8, fig.cap="Distribution of environmental variables in the protected watershed. Note that the number of fish released and ocean productivity (chlorophyll a) are measured at the watershed level while others are measured at the site level."}

suppressMessages(source(here::here("code/si_figure_env.R")))

print(g_env)
```

\newpage

## Correlation plot

```{r fig-cor, fig.width=11, fig.height=11, fig.cap="Correlation plot among environmental variables in the protected watersheds. Numbers indicate Spearman's rank correlations."}

suppressMessages(source(here::here("code/si_figure_cor.R")))
```

\newpage

## Co-occurrence matrix

```{r fig-co, fig.cap="Co-occurrence matrix of stream fishes at 97 sites. Values in each cell indicate the proportion of co-occurrence for a given pair of species (off-diagonal) or the propotion of sites occurred for a given species (diagonal). Colors are proportional to the values."}

source(here::here("code/si_figure_co.R"))
knitr::include_graphics(here::here("output/figure_co.pdf"))
```

\newpage

## Empirical estimates of competition coefficients

```{r fig-int, fig.width=7, fig.height=7, fig.cap="Estimates of competition coefficients $\\alpha_{ij}$ in a multi-species Ricker model. Panels distinguish sites, and values in each cell indicate median estimates of $\\alpha_{ij}$ for a given pair of species. Cells are colored in proportion to $\\alpha_{ij}$."}

source(here::here("code/si_figure_species_int.R"))
knitr::include_graphics(here::here("output/figure_alpha_site.pdf"))
```

\newpage

# References
